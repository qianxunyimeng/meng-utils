<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>meng-utils 工具库</title><meta name="description" content="Documentation for meng-utils 工具库"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">meng-utils 工具库</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1> meng-utils 工具库 </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#util-template" id="util-template" style="color: inherit; text-decoration: none;">
  <h1>util-template</h1>
</a>
<p>使用模板公共库</p>
<p>模板提供给的命令行地址：</p>
<p><a href="https://github.com/huahuahuahuahuahua/winkcli-main/tree/master/">winkcli-main</a></p>
<p>实现的需求：🤔</p>
<ul>
<li>支持编辑器的快速补全和提示</li>
<li>自动化构建</li>
<li>支持自动生成 changlog</li>
<li>代码通过 lint 和测试后才能提交、发布</li>
</ul>

<a href="#涉及的库" id="涉及的库" style="color: inherit; text-decoration: none;">
  <h2>涉及的库</h2>
</a>
<ul>
<li>eslint + @typescript-eslint/parser 检测ts</li>
<li>typescript ts库</li>
<li>@rollup ts打包工具</li>
<li>jest 测试工具</li>
<li>@microsoft/api-extractor .d.ts 打包</li>
<li>gulp 打包</li>
<li>husky+lint-staged 预编译</li>
<li>typedoc 生成文档</li>
</ul>

<a href="#目录结构" id="目录结构" style="color: inherit; text-decoration: none;">
  <h2>目录结构</h2>
</a>
<pre><code class="language-shell"><span class="hl-0">├───.husky</span><br/><span class="hl-0">│   └───_</span><br/><span class="hl-0">├───src   工具开发</span><br/><span class="hl-0">├───README.md 文档</span><br/><span class="hl-0">├───README.tmpl.md 公共文档（可生成README.md）</span><br/><span class="hl-0">├───test  测试 </span><br/><span class="hl-0">└───...配置文件</span><br/>
</code></pre>

<a href="#示例代码" id="示例代码" style="color: inherit; text-decoration: none;">
  <h2>示例代码</h2>
</a>
<p>如需直接使用</p>
<pre><code class="language-shell"><span class="hl-0">npm run build --文件打包</span><br/><span class="hl-0">npm run dev  --监听ts文件</span><br/><span class="hl-0">npm run doc --生成文档</span><br/><span class="hl-0">npm run lint--测试</span><br/><span class="hl-0">npm run release--npm发布</span>
</code></pre>

<a href="#整体实现" id="整体实现" style="color: inherit; text-decoration: none;">
  <h2>整体实现</h2>
</a>

<a href="#初始化项目" id="初始化项目" style="color: inherit; text-decoration: none;">
  <h3>初始化项目</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">mkdir util-template 新建文件夹</span><br/><span class="hl-1">cd</span><span class="hl-0"> util-template</span><br/><span class="hl-0">npm init 初始化</span>
</code></pre>

<a href="#安装-typescript" id="安装-typescript" style="color: inherit; text-decoration: none;">
  <h3>安装 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.tslang.cn%2Fdocs%2Fhome.html">TypeScript</a></h3>
</a>
<pre><code><span class="hl-2">npm</span><span class="hl-0"> </span><span class="hl-2">i</span><span class="hl-0"> -</span><span class="hl-3">D</span><span class="hl-0"> </span><span class="hl-2">typescript</span>
</code></pre>
<p>创建 <code>src</code> 目录，入口文件，以及 ts 的配置文件</p>
<pre><code><span class="hl-2">util</span><span class="hl-0">-</span><span class="hl-2">template</span><br/><span class="hl-0"> |</span><br/><span class="hl-0"> |- </span><span class="hl-2">src</span><br/><span class="hl-0">      |- </span><span class="hl-2">main</span><span class="hl-0">.</span><span class="hl-2">ts</span><br/><span class="hl-0"> |- </span><span class="hl-2">test</span><br/><span class="hl-0">      |- </span><span class="hl-2">main</span><span class="hl-0">.</span><span class="hl-2">test</span><span class="hl-0">.</span><span class="hl-2">ts</span><br/><span class="hl-0"> |- </span><span class="hl-2">tsconfig</span><span class="hl-0">.</span><span class="hl-2">json</span>
</code></pre>

<a href="#tsconfigjson文件配置" id="tsconfigjson文件配置" style="color: inherit; text-decoration: none;">
  <h3>tsconfig.json文件配置</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-4">&quot;compilerOptions&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">    /* Visit https://aka.ms/tsconfig.json to </span><span class="hl-1">read</span><span class="hl-0"> more about this file */</span><br/><span class="hl-0">    /* Basic Options */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;incremental&quot;</span><span class="hl-0">: true,                         /* Enable incremental compilation */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;target&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;es5&quot;</span><span class="hl-0">, /* Specify ECMAScript target version: </span><span class="hl-4">&#39;ES3&#39;</span><span class="hl-0"> (default), </span><span class="hl-4">&#39;ES5&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2015&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2016&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2017&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2018&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2019&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2020&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;ES2021&#39;</span><span class="hl-0">, or </span><span class="hl-4">&#39;ESNEXT&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;module&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;commonjs&quot;</span><span class="hl-0">, /* Specify module code generation: </span><span class="hl-4">&#39;none&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;commonjs&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;amd&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;system&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;umd&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;es2015&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;es2020&#39;</span><span class="hl-0">, or </span><span class="hl-4">&#39;ESNext&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;lib&quot;</span><span class="hl-0">: [</span><span class="hl-4">&quot;es6&quot;</span><span class="hl-0">],</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;allowJs&quot;</span><span class="hl-0">: true, /* Allow javascript files to be compiled. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;checkJs&quot;</span><span class="hl-0">: true,                             /* Report errors </span><span class="hl-5">in</span><span class="hl-0"> .js files. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;jsx&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;preserve&quot;</span><span class="hl-0">,                           /* Specify JSX code generation: </span><span class="hl-4">&#39;preserve&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;react-native&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;react&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;react-jsx&#39;</span><span class="hl-0"> or </span><span class="hl-4">&#39;react-jsxdev&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;declaration&quot;</span><span class="hl-0">: true, /* Generates corresponding </span><span class="hl-4">&#39;.d.ts&#39;</span><span class="hl-0"> file. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;declarationDir&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;./types&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;declarationMap&quot;</span><span class="hl-0">: true,                      /* Generates a sourcemap </span><span class="hl-5">for</span><span class="hl-0"> each corresponding </span><span class="hl-4">&#39;.d.ts&#39;</span><span class="hl-0"> file. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;sourceMap&quot;</span><span class="hl-0">: true,                           /* Generates corresponding </span><span class="hl-4">&#39;.map&#39;</span><span class="hl-0"> file. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;outFile&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;./&quot;</span><span class="hl-0">,                             /* Concatenate and emit output to single file. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;outDir&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;./&quot;</span><span class="hl-0">,                              /* Redirect output structure to the directory. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;rootDir&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;./&quot;</span><span class="hl-0">,                             /* Specify the root directory of input files. Use to control the output directory structure with --outDir. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;composite&quot;</span><span class="hl-0">: true,                           /* Enable project compilation */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;tsBuildInfoFile&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;./&quot;</span><span class="hl-0">,                     /* Specify file to store incremental compilation information */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;removeComments&quot;</span><span class="hl-0">: true,                      /* Do not emit comments to output. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noEmit&quot;</span><span class="hl-0">: true,                              /* Do not emit outputs. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;importHelpers&quot;</span><span class="hl-0">: true,                       /* Import emit helpers from </span><span class="hl-4">&#39;tslib&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;downlevelIteration&quot;</span><span class="hl-0">: true,                  /* Provide full support </span><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-2">iterables</span><span class="hl-0"> </span><span class="hl-5">in</span><span class="hl-0"> </span><span class="hl-4">&#39;for-of&#39;</span><span class="hl-0">, spread, and destructuring when targeting </span><span class="hl-4">&#39;ES5&#39;</span><span class="hl-0"> or </span><span class="hl-4">&#39;ES3&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;isolatedModules&quot;</span><span class="hl-0">: true,                     /* Transpile each file as a separate module (similar to </span><span class="hl-4">&#39;ts.transpileModule&#39;</span><span class="hl-0">). */</span><br/><span class="hl-0">    /* Strict Type-Checking Options */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;strict&quot;</span><span class="hl-0">: true, /* Enable all strict type-checking options. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;noImplicitAny&quot;</span><span class="hl-0">: false, /* Raise error on expressions and declarations with an implied </span><span class="hl-4">&#39;any&#39;</span><span class="hl-0"> type. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;strictNullChecks&quot;</span><span class="hl-0">: true,                    /* Enable strict null checks. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;strictFunctionTypes&quot;</span><span class="hl-0">: true,                 /* Enable strict checking of </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-1">types.</span><span class="hl-0"> */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;strictBindCallApply&quot;</span><span class="hl-0">: true,                 /* Enable strict </span><span class="hl-4">&#39;bind&#39;</span><span class="hl-0">, </span><span class="hl-4">&#39;call&#39;</span><span class="hl-0">, and </span><span class="hl-4">&#39;apply&#39;</span><span class="hl-0"> methods on functions. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;strictPropertyInitialization&quot;</span><span class="hl-0">: true,        /* Enable strict checking of property initialization </span><span class="hl-5">in</span><span class="hl-0"> classes. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noImplicitThis&quot;</span><span class="hl-0">: true,                      /* Raise error on </span><span class="hl-4">&#39;this&#39;</span><span class="hl-0"> expressions with an implied </span><span class="hl-4">&#39;any&#39;</span><span class="hl-0"> type. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;alwaysStrict&quot;</span><span class="hl-0">: true,                        /* Parse </span><span class="hl-5">in</span><span class="hl-0"> strict mode and emit </span><span class="hl-4">&quot;use strict&quot;</span><span class="hl-0"> </span><span class="hl-5">for</span><span class="hl-0"> each </span><span class="hl-1">source</span><span class="hl-0"> file. */</span><br/><span class="hl-0">    /* Additional Checks */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noUnusedLocals&quot;</span><span class="hl-0">: true,                      /* Report errors on unused locals. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noUnusedParameters&quot;</span><span class="hl-0">: true,                  /* Report errors on unused parameters. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noImplicitReturns&quot;</span><span class="hl-0">: true,                   /* Report error when not all code paths </span><span class="hl-5">in</span><span class="hl-0"> </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-1">return</span><span class="hl-0"> a value. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noFallthroughCasesInSwitch&quot;</span><span class="hl-0">: true,          /* Report errors </span><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-2">fallthrough cases</span><span class="hl-0"> </span><span class="hl-5">in</span><span class="hl-0"> switch statement. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noUncheckedIndexedAccess&quot;</span><span class="hl-0">: true,            /* Include </span><span class="hl-4">&#39;undefined&#39;</span><span class="hl-0"> </span><span class="hl-5">in</span><span class="hl-0"> index signature results */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noImplicitOverride&quot;</span><span class="hl-0">: true,                  /* Ensure overriding members </span><span class="hl-5">in</span><span class="hl-0"> derived classes are marked with an </span><span class="hl-4">&#39;override&#39;</span><span class="hl-0"> modifier. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;noPropertyAccessFromIndexSignature&quot;</span><span class="hl-0">: true,  /* Require undeclared properties from index signatures to use element accesses. */</span><br/><span class="hl-0">    /* Module Resolution Options */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;moduleResolution&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;node&quot;</span><span class="hl-0">, /* Specify module resolution strategy: </span><span class="hl-4">&#39;node&#39;</span><span class="hl-0"> (Node.js) or </span><span class="hl-4">&#39;classic&#39;</span><span class="hl-0"> (TypeScript pre-1.6). */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;baseUrl&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;./&quot;</span><span class="hl-0">,                             /* Base directory to resolve non-absolute module names. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;paths&quot;</span><span class="hl-0">: {},                                 /* A series of entries which re-map imports to lookup locations relative to the </span><span class="hl-4">&#39;baseUrl&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;rootDirs&quot;</span><span class="hl-0">: [],                              /* List of root folders whose combined content represents the structure of the project at runtime. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;typeRoots&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">      </span><span class="hl-4">&quot;node_modules/@types&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-4">&quot;@types&quot;</span><br/><span class="hl-0">    ], /* List of folders to include </span><span class="hl-1">type</span><span class="hl-0"> definitions from. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;types&quot;</span><span class="hl-0">: [],                                 /* Type declaration files to be included </span><span class="hl-5">in</span><span class="hl-0"> compilation. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;allowSyntheticDefaultImports&quot;</span><span class="hl-0">: true, /* Allow default imports from modules with no default export. This does not affect code emit, just typechecking. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;esModuleInterop&quot;</span><span class="hl-0">: true, /* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects </span><span class="hl-5">for</span><span class="hl-0"> all imports. Implies </span><span class="hl-4">&#39;allowSyntheticDefaultImports&#39;</span><span class="hl-0">. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;preserveSymlinks&quot;</span><span class="hl-0">: true,                    /* Do not resolve the real path of symlinks. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;allowUmdGlobalAccess&quot;</span><span class="hl-0">: true,                /* Allow accessing UMD globals from modules. */</span><br/><span class="hl-0">    /* Source Map Options */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;sourceRoot&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;&quot;</span><span class="hl-0">,                            /* Specify the location where debugger should locate TypeScript files instead of </span><span class="hl-1">source</span><span class="hl-0"> locations. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;mapRoot&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;&quot;</span><span class="hl-0">,                               /* Specify the location where debugger should locate map files instead of generated locations. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;inlineSourceMap&quot;</span><span class="hl-0">: true,                     /* Emit a single file with </span><span class="hl-1">source</span><span class="hl-0"> maps instead of having a separate file. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;inlineSources&quot;</span><span class="hl-0">: true,                       /* Emit the </span><span class="hl-1">source</span><span class="hl-0"> alongside the sourcemaps within a single file; requires </span><span class="hl-4">&#39;--inlineSourceMap&#39;</span><span class="hl-0"> or </span><span class="hl-4">&#39;--sourceMap&#39;</span><span class="hl-0"> to be set. */</span><br/><span class="hl-0">    /* Experimental Options */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;experimentalDecorators&quot;</span><span class="hl-0">: true,              /* Enables experimental support </span><span class="hl-5">for</span><span class="hl-0"> ES7 decorators. */</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;emitDecoratorMetadata&quot;</span><span class="hl-0">: true,               /* Enables experimental support </span><span class="hl-5">for</span><span class="hl-0"> emitting </span><span class="hl-1">type</span><span class="hl-0"> metadata </span><span class="hl-5">for</span><span class="hl-0"> decorators. */</span><br/><span class="hl-0">    /* Advanced Options */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;skipLibCheck&quot;</span><span class="hl-0">: true, /* Skip </span><span class="hl-1">type</span><span class="hl-0"> checking of declaration files. */</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;forceConsistentCasingInFileNames&quot;</span><span class="hl-0">: </span><span class="hl-1">true</span><span class="hl-0"> /* Disallow inconsistently-cased references to the same file. */</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-4">&quot;exclude&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;node_modules&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;dist&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;gulpfile.js&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;jest.config.js&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;rollup.config.js&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  ],</span><br/><span class="hl-0">  </span><span class="hl-4">&quot;include&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;src&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;*.js&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;test&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;types&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;gulpfile.ts&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  ],</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#配置-tsconfigeslintjson" id="配置-tsconfigeslintjson" style="color: inherit; text-decoration: none;">
  <h3>配置 tsconfig.eslint.json</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">/* tsconfig.eslint.json */</span><br/><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;compilerOptions&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;baseUrl&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;.&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;resolveJsonModule&quot;</span><span class="hl-0">: true,</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;forceConsistentCasingInFileNames&quot;</span><span class="hl-0">:true,</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;strict&quot;</span><span class="hl-0">: </span><span class="hl-1">true</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;include&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;**/*.ts&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;**/*.js&quot;</span><br/><span class="hl-0">    ],</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#配置-eslintrcjs" id="配置-eslintrcjs" style="color: inherit; text-decoration: none;">
  <h3>配置 .eslintrc.js</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">// .eslintrc.js</span><br/><span class="hl-0">const eslintrc = {</span><br/><span class="hl-0">  root: true,</span><br/><span class="hl-0">  parser: </span><span class="hl-4">&quot;@typescript-eslint/parser&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  plugins: [</span><span class="hl-4">&quot;@typescript-eslint&quot;</span><span class="hl-0">],</span><br/><span class="hl-0">  overrides: [</span><br/><span class="hl-0">    {</span><br/><span class="hl-0">      files: [</span><span class="hl-4">&quot;*.ts&quot;</span><span class="hl-0">, </span><span class="hl-4">&quot;*.tsx&quot;</span><span class="hl-0">], // Your TypeScript files extension</span><br/><br/><span class="hl-0">      // As mentioned </span><span class="hl-5">in</span><span class="hl-0"> the comments, you should extend TypeScript plugins here,</span><br/><span class="hl-0">      // instead of extending them outside the </span><span class="hl-4">`overrides`</span><span class="hl-0">.</span><br/><span class="hl-0">      // If you don</span><span class="hl-4">&#39;t want to extend any rules, you don&#39;</span><span class="hl-0">t need an </span><span class="hl-4">`extends`</span><span class="hl-0"> attribute.</span><br/><span class="hl-0">      extends: [</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;plugin:@typescript-eslint/recommended-requiring-type-checking&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      ],</span><br/><br/><span class="hl-0">      parserOptions: {</span><br/><span class="hl-0">        project: [</span><span class="hl-4">&quot;./tsconfig.json&quot;</span><span class="hl-0">], // Specify it only </span><span class="hl-5">for</span><span class="hl-0"> TypeScript files</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">  ],</span><br/><span class="hl-0">  extends: [</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;eslint:recommended&quot;</span><span class="hl-0">, // eslint 推荐规则</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="hl-0">, // ts 推荐规则</span><br/><span class="hl-0">    // </span><span class="hl-4">&quot;plugin:@typescript-eslint/eslint-recommended&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  ],</span><br/><span class="hl-0">  env: {</span><br/><span class="hl-0">    browser: true,</span><br/><span class="hl-0">    node: true,</span><br/><span class="hl-0">    es6: true,</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  parserOptions: {</span><br/><span class="hl-0">    project: </span><span class="hl-4">&quot;./tsconfig.eslint.json&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    ecmaVersion: 2019,</span><br/><span class="hl-0">    sourceType: </span><span class="hl-4">&quot;module&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    ecmaFeatures: {</span><br/><span class="hl-0">      experimentalObjectRestSpread: true,</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  rules: {}, // 自定义</span><br/><span class="hl-0">};</span><br/><br/><span class="hl-0">module.exports = eslintrc;</span>
</code></pre>

<a href="#配置-rollup安装请看packagejson" id="配置-rollup安装请看packagejson" style="color: inherit; text-decoration: none;">
  <h3>配置 rollup(安装请看package.json)</h3>
</a>

<a href="#配置-babelrc" id="配置-babelrc" style="color: inherit; text-decoration: none;">
  <h3>配置 .babelrc</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">/* .babelrc */</span><br/><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-4">&quot;presets&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">    [</span><br/><span class="hl-0">      </span><span class="hl-4">&quot;@babel/preset-env&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      {</span><br/><span class="hl-0">        /* Babel 会在 Rollup 有机会做处理之前，将我们的模块转成 CommonJS，导致 Rollup 的一些处理失败 */</span><br/><span class="hl-0">        </span><span class="hl-4">&quot;modules&quot;</span><span class="hl-0">: </span><span class="hl-1">false</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    ]</span><br/><span class="hl-0">  ]</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#配置rollupconfigjs" id="配置rollupconfigjs" style="color: inherit; text-decoration: none;">
  <h3>配置rollup.config.js</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">/*</span><br/><span class="hl-0"> * @Author: t_winkjqzhang</span><br/><span class="hl-0"> * @Date: 2022-03-31 14:34:38</span><br/><span class="hl-0"> * @LastEditTime: 2022-04-08 00:11:18</span><br/><span class="hl-0"> * @Description: Do not edit</span><br/><span class="hl-0"> */</span><br/><span class="hl-0">import resolve from </span><span class="hl-4">&quot;@rollup/plugin-node-resolve&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import path from </span><span class="hl-4">&quot;path&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import commonjs from </span><span class="hl-4">&quot;rollup-plugin-commonjs&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import typescript from </span><span class="hl-4">&quot;@rollup/plugin-typescript&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import json from </span><span class="hl-4">&quot;@rollup/plugin-json&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import babel from </span><span class="hl-4">&quot;@rollup/plugin-babel&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import { DEFAULT_EXTENSIONS } from </span><span class="hl-4">&quot;@babel/core&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import replace from </span><span class="hl-4">&quot;@rollup/plugin-replace&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import { uglify } from </span><span class="hl-4">&quot;rollup-plugin-uglify&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import clear from </span><span class="hl-4">&quot;rollup-plugin-clear&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import nodePolyfills from </span><span class="hl-4">&quot;rollup-plugin-polyfill-node&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">import pkg from </span><span class="hl-4">&quot;./package.json&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">const production = process.env.NODE_ENV === </span><span class="hl-4">&quot;production&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">const development = process.env.NODE_ENV === </span><span class="hl-4">&quot;development&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">const ext = production ? </span><span class="hl-4">&quot;min.js&quot;</span><span class="hl-0"> </span><span class="hl-1">:</span><span class="hl-0"> </span><span class="hl-4">&quot;js&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">/** 输入的文件夹 */</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_input_path = </span><span class="hl-4">&quot;src&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">/** 输出的文件夹 */</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_ouput_path = </span><span class="hl-4">&quot;dist&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">/** 需要编译的文件名（不带后缀名） */</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_input_file_name_no_ext_list = pkg._need_handle_files;</span><br/><span class="hl-0">//插件配置</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_plugins_01 = [</span><br/><span class="hl-0">  //清除dist打包文件</span><br/><span class="hl-0">  clear({</span><br/><span class="hl-0">    targets: [</span><span class="hl-4">&quot;dist&quot;</span><span class="hl-0">],</span><br/><span class="hl-0">  }),</span><br/><span class="hl-0">  // ts 的功能只在于编译出声明文件，所以 target 为 ESNext，编译交给 babel 来做</span><br/><span class="hl-0">  typescript({</span><br/><span class="hl-0">    tsconfig: </span><span class="hl-4">&quot;./tsconfig.json&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  }),</span><br/><span class="hl-0">  //Allows the node builtins to be d/ed.requireimport</span><br/><span class="hl-0">  </span><span class="hl-1">nodePolyfills</span><span class="hl-0">(),</span><br/><span class="hl-0">  resolve({</span><br/><span class="hl-0">    // 将自定义选项传递给解析插件</span><br/><span class="hl-0">    customResolveOptions: {</span><br/><span class="hl-0">      moduleDirectory: </span><span class="hl-4">&quot;node_modules&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">  }),</span><br/><span class="hl-0">  </span><span class="hl-1">commonjs</span><span class="hl-0">(), // 配合 commnjs 解析第三方模块</span><br/><span class="hl-0">  babel({</span><br/><span class="hl-0">    babelHelpers: </span><span class="hl-4">&quot;runtime&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    // 只转换源代码，不运行外部依赖</span><br/><span class="hl-0">    exclude: </span><span class="hl-4">&quot;node_modules/**&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    // babel 默认不支持 ts 需要手动添加</span><br/><span class="hl-0">    extensions: [...DEFAULT_EXTENSIONS, </span><span class="hl-4">&quot;.ts&quot;</span><span class="hl-0">],</span><br/><span class="hl-0">  }),</span><br/><span class="hl-0">  //一个汇总插件，可将 .json 文件转换为 ES6 模块。</span><br/><span class="hl-0">  </span><span class="hl-1">json</span><span class="hl-0">(),</span><br/><span class="hl-0">];</span><br/><span class="hl-0">//添加丑化插件</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_plugins_02 = </span><span class="hl-1">g_d_plugins_01.concat([uglify</span><span class="hl-0">()]);</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_3rd_lib_dep = [</span><span class="hl-4">&quot;axios&quot;</span><span class="hl-0">];</span><br/><span class="hl-1">let</span><span class="hl-0"> g_d_tasks_list = [].concat(</span><br/><span class="hl-0">  // 打包成无依赖、有压缩的 umd 文件，适用于页面通过 amd、cmd、直接引入的方式使用</span><br/><span class="hl-0">  // （因为要能独立使用，所以依赖必须打包进去，文件也必须压缩）</span><br/><span class="hl-0">  g_d_input_file_name_no_ext_list.map</span><span class="hl-4">((name) </span><span class="hl-0">=&gt;</span><span class="hl-4"> {</span><br/><span class="hl-0">    let d_replace_obj = {};</span><br/><span class="hl-0">    g_d_input_file_name_no_ext_list.forEach</span><span class="hl-4">((n) </span><span class="hl-0">=&gt;</span><span class="hl-4"> {</span><br/><span class="hl-0">      d_replace_obj[`${n}.ts`] = n;</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">    </span><span class="hl-5">return</span><span class="hl-0"> {</span><br/><span class="hl-0">      //amd为AMD标准，cjs为CommonJS标准，esm</span><span class="hl-7">\e</span><span class="hl-0">s为ES模块标准，iife为立即调用函数， umd同时支持amd、cjs和iife。</span><br/><span class="hl-0">      input: </span><span class="hl-4">`</span><span class="hl-2">${g_d_input_path}</span><span class="hl-4">/</span><span class="hl-2">${name}</span><span class="hl-4">.ts`</span><span class="hl-0">,</span><br/><span class="hl-0">      output: [</span><br/><span class="hl-0">        // 输出 commonjs 规范的代码</span><br/><span class="hl-0">        {</span><br/><span class="hl-0">          file: </span><span class="hl-4">` </span><span class="hl-2">${g_d_ouput_path}</span><span class="hl-4">/</span><span class="hl-2">${name}</span><span class="hl-4">.js`</span><span class="hl-0">,</span><br/><span class="hl-0">          format: </span><span class="hl-4">&quot;cjs&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">          name: pkg.name,</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">        // 输出 es 规范的代码</span><br/><span class="hl-0">        {</span><br/><span class="hl-0">          file: </span><span class="hl-4">`</span><span class="hl-2">${g_d_ouput_path}</span><span class="hl-4">/</span><span class="hl-2">${name}</span><span class="hl-4">.esm.js`</span><span class="hl-0">,</span><br/><span class="hl-0">          format: </span><span class="hl-4">&quot;esm&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">      ],</span><br/><span class="hl-0">      external: g_d_3rd_lib_dep.concat(</span><br/><span class="hl-0">        g_d_input_file_name_no_ext_list</span><br/><span class="hl-0">          .filter</span><span class="hl-4">((n) </span><span class="hl-0">=&gt;</span><span class="hl-4"> n </span><span class="hl-0">!==</span><span class="hl-4"> name)</span><br/><span class="hl-0">          .map((n) =&gt; path.resolve(`./src/${n}.ts`))</span><br/><span class="hl-0">      ),</span><br/><span class="hl-0">      plugins: g_d_plugins_02.concat(</span><br/><span class="hl-0">        replace({</span><br/><span class="hl-0">          values: d_replace_obj,</span><br/><span class="hl-0">          preventAssign: true,</span><br/><span class="hl-0">        })</span><br/><span class="hl-0">      ),</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">  })</span><br/><span class="hl-0">);</span><br/><br/><span class="hl-6">export</span><span class="hl-0"> default g_d_tasks_list;</span>
</code></pre>

<a href="#配置-jest" id="配置-jest" style="color: inherit; text-decoration: none;">
  <h3>配置 jest</h3>
</a>
<p>工具库需要写测试</p>

<a href="#安装" id="安装" style="color: inherit; text-decoration: none;">
  <h3>安装</h3>
</a>
<pre><code><span class="hl-2">yarn</span><span class="hl-0"> </span><span class="hl-2">add</span><span class="hl-0"> -</span><span class="hl-3">D</span><span class="hl-0"> @</span><span class="hl-2">types</span><span class="hl-0">/</span><span class="hl-2">jest</span><span class="hl-0"> </span><span class="hl-2">eslint</span><span class="hl-0">-</span><span class="hl-2">plugin</span><span class="hl-0">-</span><span class="hl-2">jest</span><span class="hl-0"> </span><span class="hl-2">jest</span><span class="hl-0"> </span><span class="hl-2">ts</span><span class="hl-0">-</span><span class="hl-2">jest</span>
</code></pre>

<a href="#配置-jestconfigjs" id="配置-jestconfigjs" style="color: inherit; text-decoration: none;">
  <h3>配置 jest.config.js</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">// jest.config.js</span><br/><span class="hl-0">module.exports = {</span><br/><span class="hl-0">  preset: </span><span class="hl-4">&#39;ts-jest&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  testEnvironment: </span><span class="hl-4">&#39;node&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#maints" id="maints" style="color: inherit; text-decoration: none;">
  <h3>main.ts</h3>
</a>
<pre><code class="language-shell"><span class="hl-4">&quot;use strict&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">// 静态加载</span><br/><br/><span class="hl-6">export</span><span class="hl-0"> </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-1">main()</span><span class="hl-0"> {</span><br/><span class="hl-0">  console.log(</span><span class="hl-4">&quot;hello world&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">}</span><br/><span class="hl-6">export</span><span class="hl-0"> default main;</span>
</code></pre>

<a href="#maintestts" id="maintestts" style="color: inherit; text-decoration: none;">
  <h3>main.test.ts</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">import main from </span><span class="hl-4">&quot;../src/main&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">describe(</span><span class="hl-4">&quot;Name of the group&quot;</span><span class="hl-0">, () =&gt; {</span><br/><span class="hl-0">  test(</span><span class="hl-4">&quot;should &quot;</span><span class="hl-0">, () =&gt; {</span><br/><span class="hl-0">    console.log = </span><span class="hl-1">jest.fn</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-1">main</span><span class="hl-0">();</span><br/><span class="hl-0">    // The first argument of the first call to the </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-1">was</span><span class="hl-0"> </span><span class="hl-4">&#39;hello&#39;</span><br/><span class="hl-0">    expect(console.log).toHaveBeenCalledWith(</span><span class="hl-4">&quot;hello world&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">});</span>
</code></pre>

<a href="#增加-packagejson-scripts" id="增加-packagejson-scripts" style="color: inherit; text-decoration: none;">
  <h3>增加 package.json scripts</h3>
</a>
<pre><code class="language-shell"><span class="hl-4">&quot;test&quot;</span><span class="hl-0">: </span><span class="hl-4">&quot;jest --coverage --verbose -u&quot;</span>
</code></pre>
<ul>
<li>coverage 输出测试覆盖率</li>
<li>verbose 层次显示测试套件中每个测试的结果，会看着更加直观啦</li>
</ul>

<a href="#配置-gulpfile" id="配置-gulpfile" style="color: inherit; text-decoration: none;">
  <h3>配置 gulpfile</h3>
</a>
<p>构建流程🤔 </p>
<ol>
<li>eslint检测代码--taskeslint</li>
<li>删除 dist文件，Rollup 重新打包 --taskBuildTsProject</li>
<li>读取commit，写到日志--taskchangelog</li>
<li>构建文档 --exports.buildTypes </li>
<li>api-extractor 生成统一的声明文件，然后 删除多余的声明文件</li>
<li>生成umd和esm的模块代码 --taskBuildUmdEsm</li>
<li>完成</li>
</ol>
<pre><code class="language-shell"><span class="hl-0">//eslint检测代码--jest测试</span><br/><span class="hl-0">const taskeslint = () =&gt; {</span><br/><span class="hl-0">  </span><span class="hl-5">return</span><span class="hl-0"> new Promise(function (resolve, reject) {</span><br/><span class="hl-0">    const cmdStr = </span><span class="hl-4">`</span><span class="hl-2">${path.resolve(</span><br/><span class="hl-2">      </span><span class="hl-4">&quot;./node_modules/.bin/eslint&quot;</span><br/><span class="hl-2">    )}</span><span class="hl-4"> --fix --ext .js,.ts  </span><span class="hl-2">${paths.src}</span><span class="hl-4">`</span><span class="hl-0">;</span><br/><span class="hl-0">    exec(cmdStr, (err, stdout, stderr) =&gt; {</span><br/><span class="hl-0">      </span><span class="hl-5">if</span><span class="hl-0"> (err) {</span><br/><span class="hl-0">        console.log(err);</span><br/><span class="hl-0">        console.warn(new </span><span class="hl-1">Date</span><span class="hl-0">(), </span><span class="hl-4">&quot; eslint编译命令执行失败&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-5">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        console.log(stdout);</span><br/><span class="hl-0">        console.warn(new </span><span class="hl-1">Date</span><span class="hl-0">(), </span><span class="hl-4">&quot; eslint编译命令执行成功&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><br/><span class="hl-0">    </span><span class="hl-1">resolve</span><span class="hl-0">();</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">};</span>
</code></pre>
<pre><code class="language-shell"><span class="hl-0">/** 删除 dist文件，Rollup 重新打包 */</span><br/><span class="hl-0">const taskBuildTsProject = (done) =&gt; {</span><br/><span class="hl-0">  const cmdStr = </span><span class="hl-4">`</span><span class="hl-2">${path.resolve(</span><span class="hl-4">&quot;./node_modules/.bin/rollup&quot;</span><span class="hl-2">)}</span><span class="hl-4"> -c`</span><span class="hl-0">;</span><br/><span class="hl-0">  exec(cmdStr, (err, stdout, stderr) =&gt; {</span><br/><span class="hl-0">    </span><span class="hl-5">if</span><span class="hl-0"> (err) {</span><br/><span class="hl-0">      console.log(err);</span><br/><span class="hl-0">      console.warn(new </span><span class="hl-1">Date</span><span class="hl-0">(), </span><span class="hl-4">&quot; 打包执行失败&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">    } </span><span class="hl-5">else</span><span class="hl-0"> {</span><br/><span class="hl-0">      console.log(stdout);</span><br/><span class="hl-0">      console.warn(new </span><span class="hl-1">Date</span><span class="hl-0">(), </span><span class="hl-4">&quot; 打包执行成功&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  </span><span class="hl-1">done</span><span class="hl-0">();</span><br/><span class="hl-0">};</span>
</code></pre>
<pre><code class="language-shell"><span class="hl-0">读取commit，写到日志</span><br/><span class="hl-0">//读取commit 修改CHANGELOG.md</span><br/><span class="hl-0">const taskchangelog = async (cb) =&gt; {</span><br/><span class="hl-0">  const changelogPath = path.join(paths.root, </span><span class="hl-4">&quot;CHANGELOG.md&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  // 对命令 conventional-changelog -p angular -i CHANGELOG.md -w -r 0</span><br/><span class="hl-0">  const changelogPipe = await conventionalChangelog({</span><br/><span class="hl-0">    preset: </span><span class="hl-4">&quot;angular&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    releaseCount: 0,</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  changelogPipe.setEncoding(</span><span class="hl-4">&quot;utf8&quot;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  const resultArray = [</span><span class="hl-4">&quot;# 工具库更新日志\n\n&quot;</span><span class="hl-0">];</span><br/><span class="hl-0">  changelogPipe.on(</span><span class="hl-4">&quot;data&quot;</span><span class="hl-0">, (chunk) =&gt; {</span><br/><span class="hl-0">    // 原来的 commits 路径是进入提交列表</span><br/><span class="hl-0">    chunk = chunk.replace(/</span><span class="hl-7">\/</span><span class="hl-0">commits</span><span class="hl-7">\/</span><span class="hl-0">/g, </span><span class="hl-4">&quot;/commit/&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">    resultArray.push(chunk);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  changelogPipe.on(</span><span class="hl-4">&quot;end&quot;</span><span class="hl-0">, </span><span class="hl-1">async</span><span class="hl-0"> () =&gt; {</span><br/><span class="hl-0">    await fs.createWriteStream(changelogPath).write(resultArray.join(</span><span class="hl-4">&quot;&quot;</span><span class="hl-0">));</span><br/><span class="hl-0">    </span><span class="hl-1">cb</span><span class="hl-0">();</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">};</span>
</code></pre>
<pre><code class="language-shell"><span class="hl-0">构建文档(代码过多不展示)</span><br/><span class="hl-0">exports.buildTypes = gulp.series(</span><br/><span class="hl-0">  taskCleanTypes,--清除 types 文件</span><br/><span class="hl-0">  taskOutputTypes,--使用 tsc 输出 .d.ts</span><br/><span class="hl-0">  taskCleanTypesDirUnuseFile,--清除 types 文件</span><br/><span class="hl-0">  exports.doc --type doc 任务</span><br/><span class="hl-0">  apiExtractorGenerate</span><br/><span class="hl-0">);</span><br/>
</code></pre>

<a href="#优化开发流程" id="优化开发流程" style="color: inherit; text-decoration: none;">
  <h3>优化开发流程</h3>
</a>

<a href="#安装-1" id="安装-1" style="color: inherit; text-decoration: none;">
  <h3>安装</h3>
</a>
<pre><code><span class="hl-2">yarn</span><span class="hl-0"> </span><span class="hl-2">add</span><span class="hl-0"> -</span><span class="hl-3">D</span><span class="hl-0"> </span><span class="hl-2">husky</span><span class="hl-0"> </span><span class="hl-2">lint</span><span class="hl-0">-</span><span class="hl-2">staged</span>
</code></pre>

<a href="#packagejson" id="packagejson" style="color: inherit; text-decoration: none;">
  <h3>package.json</h3>
</a>
<pre><code><span class="hl-0">  </span><span class="hl-4">&quot;husky&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;hooks&quot;</span><span class="hl-2">:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">&quot;pre-commit&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-4">&quot;lint-staged &amp; jest -u&quot;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-4">&quot;lint-staged&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-4">&quot;*.{.ts,.js}&quot;</span><span class="hl-2">:</span><span class="hl-0"> [</span><br/><span class="hl-0">      </span><span class="hl-4">&quot;eslint&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-4">&quot;git add&quot;</span><br/><span class="hl-0">    ]</span><br/><span class="hl-0">  }</span><br/>
</code></pre>
<p>之后提交代码都会先 lint 验证，再 jest 测试通过，才可以提交。规范团队协作的代码规范</p>

<a href="#仓库地址" id="仓库地址" style="color: inherit; text-decoration: none;">
  <h3>仓库地址</h3>
</a>
<p><a href="https://github.com/huahuahuahuahuahua/util-template">huahuahuahuahuahua/util-template: 提供给winkcli-main的模板库 (github.com)</a></p>

<a href="#参考" id="参考" style="color: inherit; text-decoration: none;">
  <h2>参考</h2>
</a>
<p><a href="https://juejin.cn/post/6844904035309322254#heading-36">TypeScript、Rollup 搭建工具库 - 掘金 (juejin.cn)</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.gulpjs.com.cn%2Fdocs%2Fgetting-started%2Fquick-start%2F">gulp</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2016%2F01%2Fcommit_message_change_log.html">Commit message 和 Change log 编写指南</a></p>

<a href="#本文章链接：" id="本文章链接：" style="color: inherit; text-decoration: none;">
  <h4>本文章链接：</h4>
</a>
<p><a href="https://juejin.cn/post/7083911355509506055/">学习用ts+gulp+rollup写一个工具库 - 掘金 (juejin.cn)</a></p>

<a href="#support" id="support" style="color: inherit; text-decoration: none;">
  <h2>Support</h2>
</a>
<p>Tested in Chrome 74-75, Firefox 66-67, IE 11, Edge 18, Safari 11-12, &amp; Node.js 8-12.</p>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>LICENSE</h2>
</a>
<p>MIT</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Modules</a></li><li class=" tsd-kind-module"><a href="modules/dom.html">dom</a></li><li class=" tsd-kind-module"><a href="modules/string.html">string</a></li><li class=" tsd-kind-module"><a href="modules/utils.html">utils</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>